---
layout: post
title: "Обзор Carbon AS 3 (Ideco AS 3)"
date: '2012-09-12 19:05:00'
tags:
- ideco_asr
- ideco_a_s
- ideco_a_s_4
- radius
- billingh
- intierniet
- siervier_dostupa
- softroutier
---

## Carbon AS 3 (раньше Ideco AS 3)
Уже около полугода я занимаюсь сервером доступа, созданного для максимально быстрой установки и настройки для работы с биллингом Ideco АСР 3\. После того как очередной клиент спросил - а что за Ideco AS, я понял, что тема как-то не особо освещена. Так вот, ниже я подробно расскажу, что это за Ideco AS.

## Что это такое?
Ideco AS - операционная система на базе Linux, представляющая из себя сервер доступа для абонентов интернет провайдеров. Нужен он для того, чтобы вместо того, чтобы заниматься настройкой redback, cisco, huawei итд сисадмин мог один раз настроить сеть, указать адрес и radius secret биллинга и забыть о нём. Таким образом, Ideco AS представляет из себя коробочный продукт, который отлично работает сразу после установки.

## История появления
Ideco AS - это практически "брат близнец" биллинговой системы Ideco АСР. Они создаются на одной системе сборки, так что общие улучшения внесенные в Ideco АСР автоматически попадают в Ideco AS и наоборот. 

## Что умеет
А умеет он следующее: Полностью настраиваться за 5-10 минут.Работает через Radius, поддерживает авторизацию пользователей:по IP (в том числе и opt82),по PPTP (VPN)по L2TPпо PPPoEУмеет посылать на биллинг статистику по netflow, так что закон с хранением статистики в течении 3 лет не нарушается.Имеет кучу настроек QoS.Имеет динамические шейперы, т.е. возможность практически моментально менять максимальную и гарантированную скорости каждого отдельного абонента.Поддерживает большую часть современных десятигигабитных сетевых карт.Обновляется без потери настроек и данных.Подробнее про первый пункт:Всё, что нужно указать серверу после установки, это:Внешний IP адрес, шлюз до вышестоящего провайдера и адреса DNSВнутренний IP адресРегистрационный номер. В случае с бесплатной лицензией получить его можно где-то минут за 5, позвонив в отдел продаж.Адрес Ideco АСРRadius Secret (указываемый в настройках биллинга)После этого сделать мягкую перезагрузку (длится около 20 секунд), заварить чайку и любоваться работой сервера :)

## Какие плюшки
А теперь самое сочное: сервер выдерживает более 2000 одновременных соединений, при этом даже не думает притормаживать. А ниже немного о том, как это было достигнуто:PPTP, L2TP и PPPoE работают на уровне ядра, в результате при обработке пакетов достигается высокая производительность за счёт исключения лишних переключений контекста.Система шейпинга жестко переработана (а именно драйвер IMQ девайсов), что позволило сократить время блокировки очереди пакетов более чем в 4-5 раз.Менее сочное, но тоже интересное: многие почему-то удивляются почему используется ядро 2.4, в то время как стабильная версия ванильного ядра на момент написания статьи - 3.5\. Ответ прост - оно стабильно, плюс многие части ядра переработаны нами так, что оно обгоняет по производительности ванильные ядра текущих версий.Ещё один плюс - мы часто делаем feature requests. При наличии большой платной лицензии делаем их в 95% случаев (если они не повредят остальным пользователям и в целом адекватны, например интеграция какой-нибудь платежной системы), при отсутсвии платной лицензии тоже делаем, но только в случае если идея фичи крутая, реально будет всем полезна и на её реализацию не надо тратить много времени.

## Что уже готово в четвертой версии
Тем не менее, по причине того, что с появлением нового оборудования портировать их драйвера на патченную версию 2.4 занятие не самое лучшее, чтобы тратить на него время, сейчас я работаю над платформой для новых версий АСР и AS, которые будут доступны в ближайшее время. Ядро 2.6.32Максимальная поддержка современного оборудованияВсе VPN на уровне ядраVPN сервераPPTPL2TPPPPoE Radius плагин, позволяющий работать серверу в связке с текущей стабильной версией биллинга (Ideco АСР 3.9)Файрвол - сейчас в разработке, но простейшие функции готовы:Разрешение/запрет доступа в сетьNATПлатформаУстановщик с интеллектуальной автоматической разбивкой дискаСистема сборки дистрибутива - тоже моё творение, достаточно умна, пересобирает только нужные части системы.Временно для изоляции сервисов используются chroot'ы, в ближайшее время всё будет перенесено в LXC-контейнеры.Коллеги параллельно занимаются веб-интерфейсом администратора биллинга и личным кабинетом абонента, честно говоря у меня не было особо времени посмотреть что у них сейчас получилось, но вроде как простейшие функции тоже готовы.Да, повторюсь ещё раз для тех, кому не верится: вместо виндового приложения (АСР Manager) наконец-то будет хороший и ещё более удобный веб-интерфейс!

## Халява!
А теперь самое главное - Ideco AS версии 3 имеет бесплатную лицензию на 100 пользователей. В сочетании с бесплатной лицензией на 200 пользователей для биллинга и тремя железяками-серверами мы получаем бесплатный работающий в классическом режиме (то есть в режиме управления оборудованием) из коробки сертифицированный лицензионный биллинг + два шлюза, идеально работающие под его управлением. Как биллинг, так и сервер доступа являются сертифицированными продуктами. Более того, в классическом режиме биллингу хватит ресурсов виртуальной машины (правильно настроенной, конечно).Единственный минус такого решения - техподдержка не оказывается владельцам бесплатной лицензии, но она бывает нужна достаточно редко, а если и нужна, то стоит не так уж дорого (всяко дешевле чем з/п для выделенного админа). Тем не менее, имеется активный форум, где могут помочь с простыми вопросами и обширная документация.

## Как потестировать АСР и AS в виртуалках?
Ниже приведу способ, которым это делаю я. Уверяю, большую часть времени займет выкачивание ISO образов, поэтому советую начать это перед выполнением остальной части инструкции в фоне:/* гневный-Олег-mode-on */Какого-то черта на сайте ideco.ru сейчас выложена до ужаса старая версия Ideco AS. В четверг постараюсь исправить. Ссылки на скачивание находятся тут. Любителям халявы рекомендую указать реальный телефон, так как спустя некоторое время вам позвонит милая девушка и предложит халяв^W бесплат^W платную лицензию с поддержкой, но у неё можно будет попросить и ключ для бесплатных версий. Таким образом вам даже на звонок не придется тратиться. МАКСИМУМ ХАЛЯВЫ ЖЕ!Ну да ладно, вернемся к нашим виртуалкам.

### Мой рецепт виртуализации
Более подробная инструкция: http://linux.weirded.ru/2012/12/centos-63-libvirt.htmlБерем любой LinuxБерем компьютер с двумя сетевыми картамиУстанавливаем Libvirt, Qemu/KVM, virt-viewer.Немного перенастраиваем сеть:Создаем два bridge (br0, br1)Добавляем в них соответствующие сетевые карты (eth0, eth1)Переносим настройки сети с eth девайсов на br. br0 делаем внешним, т.е. тем, через кого комп будет ходить в интернет.Тем временем будем считать, что у нас всё скачалось и установилось. Далее выполняем следующие команды в консоли.ISO=~/Загрузки/IdecoAS_394_279.iso #позже поменяем для асрSTORAGE=/var/lib/libvirtd/imagesNAME=${ISO##*/}NAME=${ISO%.iso}sudo virt-install -n $NAME \-c $ISO -r 512 --vcpus=2 --os-type=linux \--os-variant=generic24 \--network bridge=br0,model='e1000' \--network bridge=br1,model='e1000' \--disk path=${STORAGE}/${NAME}.img,size=12,format='qcow2',cache='writeback'А дальше будет установка. Интерфейс достаточно понятный, так что я думаю, проблем, не разрешимых с помощью документации не возникнет.То же самое проделываем с АСР.Если что вот ссылка на подсказки и мануал по дальнейшей настройке.P.S: надо будет как нибудь уже запилить видео с полной установкой и настройкой обоих серверов.

## Всяческие ссылки
ChangeLog по АСР и AS, автоматически обновляется при загрузке новой версии на наш FTP. В нём можно отслеживать всяческие новые плюшки, чтобы знать, стоит ли качать новую версию и обновляться.Прямая ссылка на текущую стабильную версию Ideco AS (394_279).Форум проекта.Документация проекта.P.S.: буду рад любым отзывам в комментариях, особенно если что-то не понятно.