---
layout: post
title: "Я буду скачивать весь ithappens!"
date: '2013-01-04 11:17:00'
tags:
- linux
- html_to_pdf
- ithappens_ru
- pdf
- parsier
- chto_dielat_biez_inieta
---

Вот уже три дня мне лень оплатить свой сотовый. Вернее даже меня давит жадность при виде комиссий при оплате, поэтому я жду когда начнётся учёба, чтобы оплатить сотовый без комиссии. Собственно поэтому во время поездок у меня нет доступа к интернету. Скучно.

## Поэтому сегодня я буду скачивать весь ithappens.ru!
Для тех кому лень читать: готовый скрипт есть в репозитории на github, ссылка внизу статьи.Всё что для этого пригодится:  wkhtmltopdf и wget. Всё это есть либо в комплекте, либо в репозиториях Ubuntu, для других дистров я думаю читатель и сам сможет найти. Для начала узнаём сколько страниц на ithappens сейчас. Можно было конечно написать это в виде скрипта, но мне блин лень. Итак - 1144\. Отлично.for ((i=1144; i>0; i--)); do Первая строчка скрипта готова. Внутри этого цикла мы будем скачивать всю страницу в файл. Делать это лучше где-нибудь в отдельном каталоге /tmp.mkdir /tmp/ithappens_wget/cd /tmp/ithappens_wget/С помощью строчки в духе:wget http://ithappens.ru/page/$i -O $iПосле этого объединяем всё это чудо в один файл, для порядка прогнав список файлов через sort:ls [0-9]* | sort -n | xargs cat | egrep "(

 ithappens.html
cat здесь только для того чтобы egrep не писал в каком файле он нашёл эти строчки.Если хочется читать начиная с последних историй, то используйте вместо "sort -n" "sort -nr".Дальше нам нужно обернуть нагрепанное в следующее теги, чтобы wkhtmltopdf не сошёл с ума и не наделал нам кракозябр в cp1252.В начало:<html>        <head>                <meta http-equiv="Content-Type" content="text/html; charset=cp1251">                <link rel="stylesheet" type="text/css" href="ithappens.css">        </head>        <body></body></html>В конец:        Тут уж я думаю руками можно, потому что мне лень писать извращения с here-documents. Хотя можно будет на досуге, но не в рамках этой статьи.Добавляем простенький CSS чтобы на девайсах вроде Kindle всё читалось удобно:В прочем тут уж читатель сам в праве выбрать подходящий ему размер шрифта.hordecore@oleg:/tmp/ithappens_wget$ cat ithappens.css p {        font-size: 28px; }И последний (долгий такой) штрих - конвертим всё уже в pdf.wkhtmltopdf -s Letter full.html ithappens.pdfЖдём минуты три-четырескидываем на читалку????ПРОФИТ!P.S: Не забудьте прибраться в /tmp :)GithubА вот и готовый скрипт:https://github.com/hordecore/useful_scripts/blob/master/makehappens.sh