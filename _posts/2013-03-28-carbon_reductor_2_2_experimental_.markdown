---
layout: post
title: Carbon Reductor 2.2 (experimental)
date: '2013-03-28 07:01:00'
tags:
- carbon_reductor
- git
- novaia_viersiia
- u_r_l_fil_tratsiia_dlia_provaidierov
- iptables
- diablo_i_i
- milky_tracker
- fz_149
---

Вчера я убивал вечер за очередным проходом Diablo II, а потом внезапно решил взять и сделать кучу всяких вещей, на которые мне не хватало времени. В результате - наконец-то выпустил новую версию Carbon Reductor, в которой сделал всё то, что "не приносит компании денег". В основном все изменения в этой версии направлены на улучшение производительности, за счёт исключения более не используемой логики.Скачать можно на страничке:http://www.carbonsoft.ru/download/#carbon_reductor

### Изменения в Experimental 2.2.0
Занижена отказоустойчивость, убранны хаки доставшиеся от 2.4 ядра.Убраны некоторые проверки, которые ни разу за время работы не отрабатывали Капитально оптимизирована процедура match, принимающая skbuff и начинающая проверки: Отказ от использования копии skbuff skb2 в пользу прямого   обращения к оригиналу, т.к. теперь копия точно не модифицируется skb_shared_info не вычисляется трижды, теперь хранится в переменнойПроверка на действительность лицензии теперь выполняется только после прохода   пакета, идущего в сторону URL из списка, раньше она проводилась в самом начале функции reductor_mt, то есть для каждого пакета.Убраны все #define для userspace и kernel 2.4 версий Теперь модуль собирается ТОЛЬКО для 64битной архитектурыУлучшен вывод статистики (cat /proc/net/ipt_reductor/block_list)В системе сборки теперь 3 веткиmaster - официальная стабильная версия для клиентов, в неё вносятся только исправления.devel - временная ветка для отладки исправлений, когда всё ок - master мержится с ней.experimental - ветка с радикальными изменениями, которые можно протестировать только в реальных условиях, создана для клиентов, которым не хватает производительности модуля. Правило в iptables в результате создаётся не Reject/Drop, а просто match.

### В планах на 2.3.0
1\. Добавить в контейнер ebtables 2\. Добавить необходимый userspace в виде скриптов и меню для настройки схемы с дублированием с коммутаторов3\. Довести dnat mac'ов до состояния работы из коробки 

### В планах на 3.0.0
Как только Carbon Reductor будет заведён на продакшне у двух крупных клиентов и все их критичные тикеты будут решены - оформить всё сделанное в виде дистрибутива CentOS 6.4 (возможно к тому времени уже выйдет 6.5), в котором всё работает из коробки, возможно будет портирование части кода из дистрибутива на платформе Carbon.Добавить веб-сервер и DNAT на страницу о блокировке, для списка адресов - использовать ipset. Для начала - опционально и только для https.P.S: А помимо выпуска Experimental-билда я научился пользоваться MilkyTracker'ом. Трэкерная музыка таки шикарна.