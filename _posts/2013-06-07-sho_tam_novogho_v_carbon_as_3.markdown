---
layout: post
title: "Шо там нового в Carbon AS 3"
date: '2013-06-07 07:24:00'
tags:
- carbon_reductor
- novaia_viersiia
- carbon_as_3
- changelog
- sinkhronizatsiia_pol_zovatieliei
---

Мы долго готовили этот релиз, и рады сообщить, что Carbon AS 3.9.7 теперь перешёл в статус master и доступен для скачивания! Что же в нём нового?

## Список изменений

### Больше никаких проблем с активацией!
Теперь Carbon AS пишет своё состояние активации в меню "Регистрация продукта", иными словами вы практически сразу сможете узнать о том, что у вас закончилась демо-версия или, например, произошла опечатка в регномере или коде активации!

### Улучшена интеграция с Carbon Reductor
Исправлена ошибка из-за которой при включении Reductor на Carbon AS 3 пропускная способность падала практически в 3 раза.Теперь демо-версия имеет автоматическую активацию при вводе регномера, так что для установки полной версии не требуется перезагрузка и выбор специального ядра.Исправлена ошибка из-за которой Carbon Reductor приводил к Kernel Panic при старте, проблема была в инициализации вшитого списка запрещённых сайтов.Теперь в комплекте с Carbon AS 3 (как и с Ideco ACP 3) поставляется весь набор необходимых для автообновления списков и работы Carbon Reductor утилит:OpenSSL с поддержкой gost-шифрования.PHP-скрипты для работы с zapret-info.gov.ru по SOAP.И другоеВ файрволы Carbon AS и Ideco ACP добавлено опциональное разрешающее правило для подключения к нашему серверу обновлений.Иными словами уже сейчас вы можете включить фильтрацию не беспокоясь за клиентов, установив всего одну галочку в настройках локального меню!

### Множество исправлений в системе синхронизации пользователей
В очередной раз подтвердилось грустное правило - нельзя просто так взять написать приносящую пользу программу без единой ошибки. Тем не менее найденные ошибки уже исправлены!Процедура в базе данных биллинга, возвращающая данные о пользователях на NAS сервере теперь использует в качестве источника данных о SNAT не поле SNATIP в таблице USERS, а процедуру GLN_USR_SNAT. В случае использования динамических пулов больше не возникает проблема отсутствия SNAT правил, при синхронизации проблемных пользователей (команда которых от биллинга к NAS была потеряна).Исправлена ошибка в проверке на двойной запуск скрипта - запуск скрипта в cron.10min воспринимался как запущенный основной скрипт, ошибка банальная до ужаса, решаемая простым переименованием /etc/cron.10min/asr2nas_sync в /etc/cron.10min/asr2nas_sync.run, но - приводящая к неработоспособности скрипта.Скрипт стал немного безопаснее, теперь в случае если обращение к базе биллинга не прошло успешно - скрипт завершается до того, как начнётся синхронизация.В скрипт синхронизации добавлено логирование "на все случаи жизни", так что ничего не будет упущено из виду.Диагностировать проблемы стало прощеДобавлен скрипт диагностики абонентов на NAS, в идеале предназначен для нашей технической поддержки, но никто не ограничивает вас в его использовании. Его возможности:вывод информации об авторизации пользователя на биллингевывод 1 последней команды от биллинга по этому пользователю в каждом файле логов (со всеми параметрами)вывод списка всех команд (без параметров) в последнем log-файле по пользователю.вывод всех правил в iptables по пользователю.преобразование списка id пользователей через пробел в пары id-ip.Скрипт частенько меняется, так что просто запустите /usr/local/ics/support/as_debug.sh --help перед первым использованием.Первая установка стала чуть проще благодаря видеоинструкцииНаконец-то мне удалось выделить два-три часа для того, чтобы снять и прокомментировать видео установки и настройки связки Carbon AS 3 и Ideco ACP. Как видно, занимает процесс около 15 минут (и занял бы ещё меньше, если бы я не отвлёкся на 30-40 секунд в процессе)!Прочие исправления недочётов

#### Возвращено подключение к вышестоящему провайдеру по PPPoE/PPTP
Какое-то время назад, из-за множества возникающих проблем мы решали упразднить возможность настройки подключения к вышестоящему провайдеру по PPPoE/PPTP. Мы не делали серьёзных ограничений на это, просто убрали нужные пункты в локальном меню, то есть у провайдеров у которых оно уже было настроено - оно продолжило бы свою работу. Это вызвало не очень хорошие эмоции у некоторых клиентов, поэтому возможность вернули.. а вот поменять название пункта добавления интерфейсов в меню забыли.

#### Теперь на Carbon AS можно использовать sqlexec
Теперь sqlexec может подключаться к базе биллинга под пользователем KNL_USER. Раньше это работало до первой смены пароля администратора в биллинге.

#### Уменьшена вероятность переполнения кэша маршрутов
В ходе работы над оптимизацией Carbon Reductor мы подобрали более оптимальные значения для параметра gc_thresh, полезные как для Reductor, так и для NAS и АСР Softrouter, так что вероятность внезапной проблемы с резким падением пропускной способности и производительности уменьшена с крайне малой до ничтожной!

#### И прочие приятные мелочи (выдержка из git log):
Не сохранялись настройки radiusclient на Ideco AS при рестарте PPPoE-сервера и выключенном PPTP-сервере.Восстановлен встроенный DNS-сервер - bind, без него из коробки у абонентов не работал интернет.Няшная промо-страничка (по сравнению с тем что было) - http://www.carbonsoft.ru/products/carbon-as-3/promo/ЗаключениеВот такой вот милый конкурент микротика и цисок мной разрабатывается, вывозит сие чудо около 2 тысяч VPN-сессий, работает из коробки, а если одновременных соединений меньше ста - можно получить бесплатную лицензию. Ну и само собой ссылочка на скачивание:Скачать Carbon AS 3