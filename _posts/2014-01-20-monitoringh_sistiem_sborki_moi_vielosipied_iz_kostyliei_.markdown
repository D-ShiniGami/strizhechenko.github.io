---
layout: post
title: "Мониторинг систем сборки - мой велосипед из костылей."
date: '2014-01-20 18:42:00'
tags:
- linux
- sistiemy_sborki
- monitor_board
- monitoringh
---

Я два года хотел запилить что-то подобное для себя!

И таки запилил.

Взял metro-bootstrap, не имея ни малейшего понятия о том, как им пользоваться, взял в руки vim и вырезал из файлика с примером использования всё, кроме одной плитки и `<head>..</head>` с тем, во что плитка была обёрнута, воткнул вместо плитки `@@@TEMPLATE%%%`. Взял по хардкору и набросал скрипт, который стартует `socat`, собранный ручками из исходников на 44 udp порту. Взял и направил всё, что принимает `socat` в `while read` и при получении пакета теперь - перегенерирую html'ку из шаблона, заменяя template на содержимое текстового файла в формате
```
key1 value1
key2 value2
```

которое преобразуется в div нужного цвета, в зависимости от значения. Осталось прикрутить автоматическое обновление страницы раз секунд в 10 и счастье наступило.

В каких случаях это удобно? Например когда нужно куда-то отойти. Запускаем скрипт, он добавляет/обновляет значение некоего параметра на fail, а когда успешно выполнится - на ok. Вообще, по умному надо ввести ещё одно состояние - в процессе, ну-да ладно, всему своё время.

Ах да, записывать значения может кто угодно, кому не запрещено это файрволом, так что штука исключительно для доверенной локалки. Писать в Linux можно следующим образом:

``` shell
echo your_item 0 > /dev/udp/$your_ip/44
```

так что это легко вставляется в уже имеющиеся скрипты.

Посмотреть этот изврат можно на github:

http://github.com/strizhechenko/magic-monitor
