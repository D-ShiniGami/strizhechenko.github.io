---
layout: post
title: Как читать вывод утилиты "top"
date: '2015-04-04 08:55:15'
tags:
- linux
- top
---

```
Cpu(s):  4.6%us,  5.5%sy,  0.0%ni, 54.1%id, 35.1%wa,  0.0%hi,  0.7%si,  0.0%st
```

> "У меня сервер тормозит, почему?!"

В этой статье ликбез по чтению вывода `top`.

- **us** - пользовательские приложения. apache, скрипты, демоны и прочее. Плохо написали код, скорее всего. Часто - бесконечный цикл без `sleep`.
- **sy, si** - системные вещи и software interrupts - внутренности ядра, обработка пакетов итд. Тут обычно имеет смысл глянуть на то, как обрабатываются прерывания: `cat /proc/interrupts`. Можно использовать для этого [мою утилиту `irqtop`](https://github.com/strizhechenko/netutils-linux). Проблемными значениями можно считать больше `10000 * частота в GHz` на ядро.
- **wa** - ожидание ввода-вывода. Возможные причины: что-то активно обменивается данными между собой и своими детьми; если выше 70-80%, вероятно, проблема либо с диском, либо с сетевой картой.
- **id** - idle - насколько процессор "отдыхает". По идее смотреть сколько занято проще всего сделав 100%-idle.

Бывает так, что ресурсы потребляет не один процесс, а куча его детей, причём берут не качеством, а количеством. Я наблюдал такое:

``` shell
$ ps aux | grep httpd | wc -l
303
```

Каждый процесс потребляет ≈ 0.2% CPU, выходит что
```
≈0.2 * 300 ≈ 60%
```

нагрузки.
