---
layout: post
title: "Заметки о использовании grafana"
date: '2015-06-02 04:07:04'
tags:
- grafana
- podvodnyie-kamni
- monitoring
---

## Плюсы

Охренительная штука, мне очень нравится, сучки любят графики.

### API

Крутое API, всё через CURL, можно замутить автоматический деплой.

А вот так делать не надо:

    sqlite /var/lib/grafana/grafana.db .dump > /tmp/dump.sql
    scp /tmp/dump.sql root@server2:
    ssh root@server2
    > /var/lib/grafana/grafana.db
    sqlite3 /var/lib/grafana/grafana.db < dump.sql

Не удастся, ибо миграции будут ругаться и grafana-server не стартанёт. Для этого есть API.

### Автоматическое обновление страницы

Можно сидеть и ничего не делать, а оно типа работает короче.

## Минусы

### Экспорт / импорт dashboard

Экспорт у меня тупо не работал, ну да ладно, есть view json, который можно cmd+A, cmd+C, cat > dashboard.json, cmd+V.

А вот с импортом запара пожёсче - grafana упорно пытается подставлять data source указанный в экспортированном dashboard, несмотря на выбранный в настройках default. Того data source на другом сервере, конечно нет, в результате приходится **во всех графиках руками менять data source**. У меня случился буттхурт. В общем перед импортом лучше создать одноимённый data source руками, видимо (странно что их тоже нельзя экспортировать/импортировать).

Но в остальном всё работает и очень даже неплохо! 

## Запросы к influxdb и магия

### Данные о сумме за день

По идее запрос выглядит так

	SELECT Sum(value) FROM "metric" WHERE $timeFilter GROUP BY time(24h)

Но для того чтобы всё выглядело и рисовалось красиво и без ошибок надо врубить опцию "Null as zero" в "axes and grid".