---
layout: post
title: Carbon Reductor 6.1.4
date: '2016-02-15 12:24:12'
---

Мы немного пропустили описание Carbon Reductor 6.1.2, поэтому все изменения с 15.01.2016 по 15.02.2016 описаны здесь.

# Новый резолвер

Теперь он собирает информацию от всех используемых в системе DNS-серверов, для этого пришлось добавить dnspython и немного запатчить qdns. Заодно подчистили код и сделали  сообщения в логах "человечнее". Пока возможна медленная работа при недоступности одного из серверов, это будет исправлено в одном из ближайших билдов. Также планируется добавление поддержки резолва в ipv6.

# Улучшено логирование

Логирование блокировок теперь:

1. отключаемое;
2. пишется в отдельный файл /var/log/reductor/forbidden.log;
3. содержит время срабатывания, http host, src и dst IP.

Если оно дописывается в /var/log/messages, то необходимо выполнить

    service rsyslog restart.

Также улучшено логирование диагностики при недоступности сервера мониторинга

# Прочее

- в ядре всегда самые актуальные списки, так как упразднён "костыль" связанный с отсутствием double buffer. Раньше применение списков выполнялось 4 раза в день (выгружались 24 раза);
- добавлен пример хука для тюнинга нескольких сетевых карт на 32 ядрах процессора;
- повышена отказоустойчивость скрипта файрвола;
- улучшена поддержка IPv6 (меньше параметров нужно настраивать вручную, forwarding включается Carbon Reductor при рестарте, если включена опция IPv6);
- исправлены ошибки в поддержке полной блокировки IP адресов (дублирование записей, получение списка IP с маршрутизатора), новый пример хука для Linux-роутеров с ipset;
- при выборе L3 зеркала в мастере, автоматически отключается проверка настроек сети, при выборе L2/L2_vlan - включается;
- исключён повторный вызов обновления сигнатур при запуске service reductor update;
- исправлена логика распаралелливания задач выгрузки реестра, обработки списков, обновления сигнатур и резолва IP;
- замена кэша резолва теперь атомарна, в результате уменьшена вероятность появления ошибки "Проверка состояния кэша https-резолва";
- все снапшоты кэшей сохраняются при обновлении Carbon Reductor;
- улучшена поддержка белых списков (our.fullwhitelist).
