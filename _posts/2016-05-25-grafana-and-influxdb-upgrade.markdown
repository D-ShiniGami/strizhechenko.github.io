---
layout: post
title: "Обновил grafana и influxdb до 3.0.3 и 0.13.0"
date: '2016-05-25 14:33:54'
tags:
- influxdb
- grafana
- monitoring
---

У grafana то ли появился RPM-репозиторий, то ли раньше не замечал. Но теперь обновление стало чуток проще:

    service grafana-server stop
    yum -y update grafana-server
    service grafana start

При миграции с 2.6.0 на 3.0.3 никаких проблем не случилось.

Другое дело вышло с influxdb. Документацию видимо надо читать. Пользовался версией 0.9, решил обновить до 0.13.0 и "поел дерьма". При старте оно ругалось на наличие raft.db, понятия не имею что это. Но благодаря тому, что в логи пишутся все ошибки и ссылки на документацию, сравнительно быстро разобрался в том, что нужно произвести downgrade до 0.11, что-то пошаманить с метаданными и бэкапами с восстановлением, плюс запустить одну утилитку для конвертации формата шардов (вроде с bz1 до tsm, понятия не имею что это и, честно говоря не особо хочу) и после этого уже обновляться до 0.13. В итоге все работает, но как не поныть о непиятных мелочах?

Итак, что мне не нравится у influxdb, но в целом считается нормой:

- Отсутствие интеллектуального "мерджа" старого и нового конфига при обновлении (выпиливание устаревших опций, сохранение того, что изменено пользователем, добавление новых пунктов итд). Новый конфиг просто лежит рядом.
- Init скрипт считает сервер стартанувшим, несмотря на то, что тот упал при старте, запись об этом можно увидеть только вручную посмотрев логи.
- Отстутствие yum-репозитория для обновления и опции "автоматическое обновление". Впрочем это уже жир. Но так возиться при обновлении с сильно устаревшей версией как я недавно - неприятно.
